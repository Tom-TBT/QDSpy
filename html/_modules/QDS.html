<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>QDS &mdash; QDSpy 0.71 beta documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.71 beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="QDSpy 0.71 beta documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">QDSpy 0.71 beta documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for QDS</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">QDSpy module - stimulus script API</span>

<span class="sd">This is a simple Python software for scripting and presenting stimuli</span>
<span class="sd">for visual neuroscience. It is based on QDS, currently uses OpenGL via</span>
<span class="sd">pyglet for graphics. It primarly targets Windows, but may also run on </span>
<span class="sd">other operating systems</span>

<span class="sd">Copyright (c) 2013-2016 Thomas Euler</span>
<span class="sd">All rights reserved.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ---------------------------------------------------------------------</span>
<span class="n">__author__</span> 	<span class="o">=</span> <span class="s2">&quot;code@eulerlab.de&quot;</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span>   <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">QDSpy_global</span> <span class="k">as</span> <span class="nn">glo</span>
<span class="kn">import</span> <span class="nn">QDSpy_stim</span> <span class="k">as</span> <span class="nn">stm</span>
<span class="kn">import</span> <span class="nn">QDSpy_stim_support</span> <span class="k">as</span> <span class="nn">ssp</span>
<span class="kn">import</span> <span class="nn">QDSpy_config</span> <span class="k">as</span> <span class="nn">cfg</span>

<span class="c1"># ---------------------------------------------------------------------</span>
<span class="n">_Stim</span>   <span class="o">=</span> <span class="n">stm</span><span class="o">.</span><span class="n">Stim</span><span class="p">()</span>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Initialize"><a class="viewcode-back" href="../commands.html#QDS.Initialize">[docs]</a><span class="k">def</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">_sName</span><span class="o">=</span><span class="s2">&quot;noname&quot;</span><span class="p">,</span> <span class="n">_sDescr</span><span class="o">=</span><span class="s2">&quot;nodescription&quot;</span><span class="p">,</span> <span class="n">_runMode</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Initializes the QDS library. Needs to be called **before** any other</span>
<span class="sd">  QDS command is used.</span>
<span class="sd"> </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _sName          | stimulus name </span>
<span class="sd">  _sDescr         | description of stimulus (optional)</span>
<span class="sd">  _runMode        | 0=just re-compile,  </span>
<span class="sd">                  | 1=run stimulus if script unchanged</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">nameStr</span>   <span class="o">=</span> <span class="n">_sName</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">descrStr</span>  <span class="o">=</span> <span class="n">_sDescr</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">ErrC</span>      <span class="o">=</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimErrC</span><span class="o">.</span><span class="n">ok</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">tStart</span>    <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">isRunSect</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">Conf</span>      <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span>

  <span class="c1"># Parse command-line arguments</span>
  <span class="c1">#</span>
  <span class="n">fName</span>           <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])))[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">fNameOnlyDir</span>    <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">fNameDir</span>  <span class="o">=</span> <span class="n">fNameOnlyDir</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span><span class="n">fName</span>
  <span class="n">fNameDir_py</span>     <span class="o">=</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">fNameDir</span> <span class="o">+</span><span class="s2">&quot;.py&quot;</span>
  <span class="n">fNameDir_pk</span>     <span class="o">=</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">fNameDir</span> <span class="o">+</span><span class="s2">&quot;.pickle&quot;</span>
  <span class="n">args</span>            <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">getParsedArgv</span><span class="p">()</span>

  <span class="c1"># Display startup message and return if running the up-to-date stimulus</span>
  <span class="c1"># immediately is not requested</span>
  <span class="c1">#</span>
  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;***&quot;</span><span class="p">,</span> <span class="n">glo</span><span class="o">.</span><span class="n">QDSpy_versionStr</span> <span class="o">+</span>
                <span class="s2">&quot; Compiler - &quot;</span> <span class="o">+</span><span class="n">glo</span><span class="o">.</span><span class="n">QDSpy_copyrightStr</span><span class="p">)</span>
  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Initializing ...&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_runMode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span>

  <span class="c1"># Check if pickle-file is current, if so, run the stimulus without</span>
  <span class="c1"># recompiling</span>
  <span class="c1">#</span>
  <span class="n">tLastUpt_py</span>     <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fNameDir_py</span><span class="p">))</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">tLastUpt_pick</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fNameDir_pk</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tLastUpt_pick</span> <span class="o">&gt;</span> <span class="n">tLastUpt_py</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">compile</span><span class="p">):</span>
      <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;Script has not changed, running stimulus now ...&quot;</span><span class="p">)</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;python ..\QDSpy_core.py -t=</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">timing</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fName</span><span class="p">))</span>
      <span class="n">exit</span><span class="p">()</span>
  <span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
    <span class="k">pass</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="GetDefaultRefreshRate"><a class="viewcode-back" href="../commands.html#QDS.GetDefaultRefreshRate">[docs]</a><span class="k">def</span> <span class="nf">GetDefaultRefreshRate</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Returns the refresh rate (in Hz) defined in the QDS configuration files.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_Stage</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">createStageFromConfig</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">_Stage</span><span class="o">.</span><span class="n">scrReqFreq_Hz</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="GetStimulusPath"><a class="viewcode-back" href="../commands.html#QDS.GetStimulusPath">[docs]</a><span class="k">def</span> <span class="nf">GetStimulusPath</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Returns the current path of the stimulus folder. Use this function</span>
<span class="sd">  to make sure that the script can locate user-provided accessory files</span>
<span class="sd">  (e.g. a random number series for a noise stimulus):</span>
<span class="sd">  ::</span>
<span class="sd">    path = QDS.getStimulusPath()</span>
<span class="sd">    file = open(path +&quot;parameters.txt&quot;, &quot;r&quot;)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">Conf</span><span class="o">.</span><span class="n">pathStim</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="LogUserParameters"><a class="viewcode-back" href="../commands.html#QDS.LogUserParameters">[docs]</a><span class="k">def</span> <span class="nf">LogUserParameters</span><span class="p">(</span><span class="n">_dict</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Writes a user-defined set of parameters to the history and log file.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _dict           | dictionary with parameters</span>
<span class="sd">                  | as key-value pairs</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  </span>
<span class="sd">  Example for such a user parameter entry as it appears in the history</span>
<span class="sd">  and log file:</span>
<span class="sd">  :: </span>
<span class="sd">    20151220_135948    DATA {&#39;nTrials&#39;: 1, &#39;dxStim_um&#39;: 1000}</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">logUserParameters</span><span class="p">(</span><span class="n">_dict</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;logUserParameters: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<span class="c1">#def getScreenSize():</span>
<span class="c1">#  &quot;&quot;&quot;</span>
<span class="c1">#  Returns the current screen size as (dx,dy) tupple.</span>
<span class="c1">#  &quot;&quot;&quot;</span>
<span class="c1">#  _Stage = cfg.Config().createStageFromConfig()</span>
<span class="c1">#  return (_Stage.dxScr, _Stage.dyScr)</span>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetColorLUTEntry"><a class="viewcode-back" href="../commands.html#QDS.SetColorLUTEntry">[docs]</a><span class="k">def</span> <span class="nf">SetColorLUTEntry</span> <span class="p">(</span><span class="n">_index</span><span class="p">,</span> <span class="n">_rgb</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Redefines an entry in the colour lookup table (LUT), allowing to linearize</span>
<span class="sd">  the intensity range of a display. </span>

<span class="sd">  Note that it alters the gamma LUT at **run-time** </span>
<span class="sd">  (see section :doc:`how_QDSpy_works`) on the operation system-side, that is </span>
<span class="sd">  for *all* connected display devices, including the screen that shows the </span>
<span class="sd">  GUI. </span>
<span class="sd">  </span>
<span class="sd">  When the program ends, a linear gamma LUT will be automatically restored. </span>
<span class="sd">  </span>
<span class="sd">  While this adjustment is completely independent of the color mode setting </span>
<span class="sd">  (see :py:func:`QDS.setColorMode`), it is only meaningful for color modes</span>
<span class="sd">  0 and 1, and not for special lightcrafter modes. Therefore, LUT corrections</span>
<span class="sd">  will not be applied to stimuli using color modes &gt;1.</span>
<span class="sd"> </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _index          | LUT index, 0..255</span>
<span class="sd">  _rgb            | new LUT entries as tuple (r, g, b)</span>
<span class="sd">                  | with r,g,b in 0..255</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">setColorLUTEntry</span><span class="p">(</span><span class="n">_index</span><span class="p">,</span> <span class="n">_rgb</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;LUT_changeEntry(Ex): </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetColorMode"><a class="viewcode-back" href="../commands.html#QDS.SetColorMode">[docs]</a><span class="k">def</span> <span class="nf">SetColorMode</span><span class="p">(</span><span class="n">_depth_bit</span><span class="p">,</span> <span class="n">_shift_bit</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                 <span class="n">_mode</span><span class="o">=</span><span class="n">stm</span><span class="o">.</span><span class="n">ColorMode</span><span class="o">.</span><span class="n">_0_255</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Set color mode and bit depth as well as bit offset.</span>
<span class="sd">  </span>
<span class="sd">  .. note:: Note that this conversion happens at **compile-time** </span>
<span class="sd">            (see section :doc:`how_QDSpy_works`). Changing the mode requires</span>
<span class="sd">            recompilation of the script to affect presentation.</span>

<span class="sd">  Bit depth and offset each are defined by color (as (r,b,b) tuple). All</span>
<span class="sd">  color values are scaled by the given bit depth and then bitwise left-</span>
<span class="sd">  shifted by the given offset. For example, when color mode is 0..255</span>
<span class="sd">  (see below), &quot;red&quot; is scaled:</span>
<span class="sd">  ::</span>
<span class="sd">    r\&#39; = (r/255 x(2^BitDepth_r -1)) &lt;&lt; BitShift_r</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _depth_bit      | bit depth as tuple (dr, bg, bb)</span>
<span class="sd">  _shift_bit      | bit offsets are tuple (or, og, ob)</span>
<span class="sd">  _mode           | 0=color in &quot;gun&quot; values, 0..255</span>
<span class="sd">                  | 1=color as fraction, 0..1</span>
<span class="sd">                  | 2=LightCrafter mode B9G9</span>
<span class="sd">  =============== ==================================================</span>

<span class="sd">  **LightCrafter modes (EXPERIMENTAL)**</span>

<span class="sd">  (here, _depth_bit and _shift_bit are ignored.)</span>

<span class="sd">  * Mode B9G9: black+8 grey levels for green and blue LEDs (dichromatic), with</span>
<span class="sd">    blanks (=red LED) for laser-scanning (700 us LED +1400 us blank),</span>
<span class="sd">    8 lines (=16.667 ms) per stimulus frame (=60 Hz)</span>
<span class="sd">  * ...</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_depth_bit</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_depth_bit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)):</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">bitDepth</span>  <span class="o">=</span> <span class="n">_depth_bit</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_shift_bit</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_shift_bit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)):</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">bitShift</span>  <span class="o">=</span> <span class="n">_shift_bit</span>

  <span class="k">if</span> <span class="n">_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ColorMode</span><span class="o">.</span><span class="n">_0_255</span><span class="p">,</span> <span class="n">stm</span><span class="o">.</span><span class="n">ColorMode</span><span class="o">.</span><span class="n">_0_1</span><span class="p">,</span> 
               <span class="n">stm</span><span class="o">.</span><span class="n">ColorMode</span><span class="o">.</span><span class="n">LC_G9B9</span><span class="p">]:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">colorMode</span> <span class="o">=</span> <span class="n">_mode</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="StartScript"><a class="viewcode-back" href="../commands.html#QDS.StartScript">[docs]</a><span class="k">def</span> <span class="nf">StartScript</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Start of the stimulus run section. No definitions are allowed after</span>
<span class="sd">  this command. Must be called before QDS commands that generate</span>
<span class="sd">  stimulus scenes are called.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># ...</span>
  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> object(s) defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)))</span>
  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> shader(s) defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ShList</span><span class="p">)))</span>
  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span>   <span class="s2">&quot;Generating scenes ...&quot;</span><span class="p">)</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">isRunSect</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="k">return</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Loop"><a class="viewcode-back" href="../commands.html#QDS.Loop">[docs]</a><span class="k">def</span> <span class="nf">Loop</span><span class="p">(</span><span class="n">_nRepeats</span><span class="p">,</span> <span class="n">_func</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Loops the stimulus sequence generated by the given function.</span>

<span class="sd">  Note that _func is called only once and the loop is coded in the</span>
<span class="sd">  actual compiled stimulus; this can be used to keep compilation time</span>
<span class="sd">  short and reduces the copiled stimulus file size.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _nRepeats       | &gt;0 number of repeats, &lt;0 indefinitely</span>
<span class="sd">  _func           | python function that scripts a stimulus</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">loopBegin</span><span class="p">(</span><span class="n">_nRepeats</span><span class="p">)</span>
  <span class="n">_func</span><span class="p">()</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">loopEnd</span><span class="p">()</span>
  <span class="k">return</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="EndScript"><a class="viewcode-back" href="../commands.html#QDS.EndScript">[docs]</a><span class="k">def</span> <span class="nf">EndScript</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Must be called after all stimulus scenes have been created, i.e.</span>
<span class="sd">  at the end of the script.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> scene(s) defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">nSce</span><span class="p">))</span>

  <span class="c1"># Compile stimulus</span>
  <span class="c1">#</span>
  <span class="n">_Conf</span>  <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span>
  <span class="n">_Stage</span> <span class="o">=</span> <span class="n">_Conf</span><span class="o">.</span><span class="n">createStageFromConfig</span><span class="p">()</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">_Stage</span><span class="p">)</span>

  <span class="c1"># Save compiled stimulus code to a pickle file</span>
  <span class="c1">#</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  sPath         = os.path.basename(main.__file__)</span>
<span class="sd">  sFName, sFExt = os.path.splitext(sPath)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_Stim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">fNameDir</span><span class="p">)</span>

  <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="s2">&quot;... done in </span><span class="si">{0:.3f}</span><span class="s2"> s&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span><span class="n">_Stim</span><span class="o">.</span><span class="n">tStart</span><span class="p">))</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="DefObj_BoxEx"><a class="viewcode-back" href="../commands.html#QDS.DefObj_BoxEx">[docs]</a><span class="k">def</span> <span class="nf">DefObj_BoxEx</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="n">_enShader</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines a box object and if shaders can be used for this object.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  _dx,_dy         | box width and height in µm</span>
<span class="sd">  _enShader       | 0=disable shaders (default)</span>
<span class="sd">                  | 1=disable shaders,</span>
<span class="sd">                  | see :py:func:`QDS.SetObjShader`</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">isRunSect</span><span class="p">:</span>
      <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span> <span class="o">=</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimErrC</span><span class="o">.</span><span class="n">noDefsInRunSection</span>
      <span class="k">raise</span> <span class="n">stm</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Defining objects ...&quot;</span><span class="p">)</span>

    <span class="n">_Stim</span><span class="o">.</span><span class="n">defObj_box</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="n">_enShader</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Box(Ex): </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="DefObj_Box"><a class="viewcode-back" href="../commands.html#QDS.DefObj_Box">[docs]</a><span class="k">def</span> <span class="nf">DefObj_Box</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="n">_angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  See :py:func:`QDS.DefObj_BoxEx`</span>

<span class="sd">  .. note:: Note that &quot;_angle&quot; is depreciated and ignored in QDSpy. The</span>
<span class="sd">            angle of an object is now set in the render command.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">_angle</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Box: &#39;angle&#39; is depreciated&quot;</span><span class="p">)</span>
  <span class="n">DefObj_BoxEx</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="DefObj_SectorEx"><a class="viewcode-back" href="../commands.html#QDS.DefObj_SectorEx">[docs]</a><span class="k">def</span> <span class="nf">DefObj_SectorEx</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_offs</span><span class="p">,</span> <span class="n">_angle</span><span class="p">,</span> <span class="n">_awidth</span><span class="p">,</span> <span class="n">_astep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">_enShader</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines a sector object and if shaders can be used for this object.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  _r              | outer radius (of disk) in um</span>
<span class="sd">  _offs           | inner radius (=radius of center &quot;hole&quot;)</span>
<span class="sd">                  | in um (0 ≤ offs &lt; r)</span>
<span class="sd">  _angle          | rotation angle in degrees</span>
<span class="sd">                  | (of the center of the arc)</span>
<span class="sd">  _awidth         | width of sector</span>
<span class="sd">                  | (angle, in degrees)</span>
<span class="sd">  _astep          | &quot;smoothness&quot; of the arc </span>
<span class="sd">                  | (1° &lt;= _astep &lt;= 90)</span>
<span class="sd">                  | if omitted, _astep is automatically optimized</span>
<span class="sd">  _enShader       | 0=disable shaders (default)</span>
<span class="sd">                  | 1=disable shaders,</span>
<span class="sd">                  | see :py:func:`QDS.SetObjShader`</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Defining objects ...&quot;</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">defObj_sector</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_offs</span><span class="p">,</span> <span class="n">_angle</span><span class="p">,</span> <span class="n">_awidth</span><span class="p">,</span> <span class="n">_astep</span><span class="p">,</span>
                        <span class="n">_enShader</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Sector(Ex): </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="DefObj_Sector"><a class="viewcode-back" href="../commands.html#QDS.DefObj_Sector">[docs]</a><span class="k">def</span> <span class="nf">DefObj_Sector</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_offs</span><span class="p">,</span> <span class="n">_angle</span><span class="p">,</span> <span class="n">_awidth</span><span class="p">,</span> <span class="n">_astep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  See :py:func:`QDS.DefObj_SectorEx`</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">DefObj_SectorEx</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_offs</span><span class="p">,</span> <span class="n">_angle</span><span class="p">,</span> <span class="n">_awidth</span><span class="p">,</span> <span class="n">_astep</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="DefObj_EllipseEx"><a class="viewcode-back" href="../commands.html#QDS.DefObj_EllipseEx">[docs]</a><span class="k">def</span> <span class="nf">DefObj_EllipseEx</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="n">_enShader</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines an ellipse object.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  _dx,_dy         | ellipse diameters in µm</span>
<span class="sd">  _enShader       | 0=disable shaders (default)</span>
<span class="sd">                  | 1=disable shaders,</span>
<span class="sd">                  | see :py:func:`QDS.SetObjShader`</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Defining objects ...&quot;</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">defObj_ellipse</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="n">_enShader</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Ellipse: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

  <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="DefObj_Ellipse"><a class="viewcode-back" href="../commands.html#QDS.DefObj_Ellipse">[docs]</a><span class="k">def</span> <span class="nf">DefObj_Ellipse</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="n">_angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  See :py:func:`QDS.DefObj_EllipseEx`</span>

<span class="sd">  .. note:: Note that &quot;_angle&quot; is depreciated and ignored in QDSpy. The</span>
<span class="sd">            angle of an object is now set in the render command.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">_angle</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Ellipse: &#39;angle&#39; is depreciated&quot;</span><span class="p">)</span>
  <span class="n">DefObj_EllipseEx</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_dx</span><span class="p">,</span> <span class="n">_dy</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="DefObj_Movie"><a class="viewcode-back" href="../commands.html#QDS.DefObj_Movie">[docs]</a><span class="k">def</span> <span class="nf">DefObj_Movie</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_fName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines and loads a movie object.</span>
<span class="sd">  </span>
<span class="sd">  A movie object consists of two files that have the same name but</span>
<span class="sd">  different extensions: a text file (.txt) that describes the dimensions</span>
<span class="sd">  of a frame and the number of frames, and an image file that contains</span>
<span class="sd">  a montage of all frames (.png, .jpg, ...).</span>
<span class="sd">  </span>
<span class="sd">  .. note:: In contrast to QDS, QDSpy considers the **bottom-left frame of</span>
<span class="sd">            a montage the first frame** (in QDS it was to top-left frame).</span>
<span class="sd">            Therefore, movie montage files have to be adapted. This can</span>
<span class="sd">            be easily done in ImageJ:</span>
<span class="sd">            </span>
<span class="sd">            1) load the montage into ImageJ</span>
<span class="sd">            2) use `Image/Stacks/Tools/Montage To Stack...` to convert the </span>
<span class="sd">               montage into a stack</span>
<span class="sd">            3) use `Image/Transform/Flip Vertically` to mirror the stack </span>
<span class="sd">               along the x axis</span>
<span class="sd">            4) use `Image/Stacks/Make Montage...` to convert the stack back</span>
<span class="sd">               into a montage</span>
<span class="sd">            5) use `Image/Transform/Flip Vertically` again now to mirror the</span>
<span class="sd">               montage along the x axis. Now the frame sequence starts with</span>
<span class="sd">               the bottom-left frame.</span>
<span class="sd">  </span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  _fName          | string with movie file name </span>
<span class="sd">                  | (with image file extension)</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Defining objects ...&quot;</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">defObj_movie</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_fName</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Movie: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="GetMovieParameters"><a class="viewcode-back" href="../commands.html#QDS.GetMovieParameters">[docs]</a><span class="k">def</span> <span class="nf">GetMovieParameters</span><span class="p">(</span><span class="n">_iobj</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Returns a list with the parameters of a movie object. The movie </span>
<span class="sd">  object must have been loaded.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Returns:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  dictionary      | &quot;dxFr&quot;, &quot;dyFr&quot;, and &quot;nFr&quot;</span>
<span class="sd">                  | with dx,dy the frame size in pixels,</span>
<span class="sd">                  | and nFr the number of frames</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">getMovieParams</span><span class="p">(</span><span class="n">_iobj</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;getMovieParameters: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">params</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="DefObj_Video"><a class="viewcode-back" href="../commands.html#QDS.DefObj_Video">[docs]</a><span class="k">def</span> <span class="nf">DefObj_Video</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_fName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines and loads a video object.</span>
<span class="sd">  </span>
<span class="sd">  A video object consists of a single file; currently the following</span>
<span class="sd">  video format(s) is/are allowed: .avi</span>
<span class="sd">  </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  _fName          | string with video file name </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Defining objects ...&quot;</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">defObj_video</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_fName</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;DefObj_Video: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>
  
<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="GetVideoParameters"><a class="viewcode-back" href="../commands.html#QDS.GetVideoParameters">[docs]</a><span class="k">def</span> <span class="nf">GetVideoParameters</span><span class="p">(</span><span class="n">_iobj</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Returns a list with the parameters of a video object. The video </span>
<span class="sd">  object must have been loaded.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | object index</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Returns:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  dictionary      | &quot;dxFr&quot;, &quot;dyFr&quot;, &quot;nFr&quot;, and &quot;fps&quot;</span>
<span class="sd">                  | with dx,dy the frame size in pixels,</span>
<span class="sd">                  | nFr the number of frames, and fps</span>
<span class="sd">                  | refresh rate in frames per second</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">getVideoParams</span><span class="p">(</span><span class="n">_iobj</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;getVideoParams: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">params</span></div>

  
<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="DefShader"><a class="viewcode-back" href="../commands.html#QDS.DefShader">[docs]</a><span class="k">def</span> <span class="nf">DefShader</span><span class="p">(</span><span class="n">_ishd</span><span class="p">,</span> <span class="n">_shType</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines a shader. For details, see :doc:`shaderfiles`.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _ishd           | shader index</span>
<span class="sd">  _shType         | string with shader type</span>
<span class="sd">                  | (from the shader folder)</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">isRunSect</span><span class="p">:</span>
      <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span> <span class="o">=</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimErrC</span><span class="o">.</span><span class="n">noDefsInRunSection</span>
      <span class="k">raise</span> <span class="n">stm</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Stim</span><span class="o">.</span><span class="n">ObjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;Defining shaders ...&quot;</span><span class="p">)</span>

    <span class="n">_Stim</span><span class="o">.</span><span class="n">defShader</span><span class="p">(</span><span class="n">_ishd</span><span class="p">,</span> <span class="n">_shType</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;DefShader: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetObjColorEx"><a class="viewcode-back" href="../commands.html#QDS.SetObjColorEx">[docs]</a><span class="k">def</span> <span class="nf">SetObjColorEx</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_ocols</span><span class="p">,</span> <span class="n">_alphas</span><span class="o">=</span><span class="p">[]):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Set color of object(s) (not defined for all object types).</span>

<span class="sd">  .. attention:: **Extended version**: Number of objects not anymore a</span>
<span class="sd">                 parameter - it is determined by the lenght of the object</span>
<span class="sd">                 index list -, and allows to define alpha (transparency)</span>
<span class="sd">                 values for each object.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobjs          | list of objects,</span>
<span class="sd">                  | [o1, o2, ...],</span>
<span class="sd">                  | with oX being valid object indices</span>
<span class="sd">  _ocols          | list of object colors in RGB values,</span>
<span class="sd">                  | [(r1,g1,b1),(r2,g2,b2), ...],</span>
<span class="sd">                  | with 0 &lt;= r,g,b &lt;= 255</span>
<span class="sd">  *_oalphas*      | *list of object alpha values, 0..255*</span>
<span class="sd">  =============== ==================================================</span>

<span class="sd">  *new or changed parameters*</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_alphas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">_alphas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">)</span> <span class="o">*</span><span class="p">[</span><span class="mi">255</span><span class="p">]</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">setObjColor</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_ocols</span><span class="p">,</span> <span class="n">_alphas</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SetObjColor(Ex): </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="k">def</span> <span class="nf">SetObjColor</span><span class="p">(</span><span class="n">_nobj</span><span class="p">,</span> <span class="n">_iobjs</span><span class="p">,</span> <span class="n">_ocols</span><span class="p">):</span>
  <span class="n">_alphas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">)</span> <span class="o">*</span><span class="p">[</span><span class="mi">255</span><span class="p">]</span>
  <span class="n">SetObjColorEx</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_ocols</span><span class="p">,</span> <span class="n">_alphas</span><span class="p">)</span>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetObjColorAlphaByVertex"><a class="viewcode-back" href="../commands.html#QDS.SetObjColorAlphaByVertex">[docs]</a><span class="k">def</span> <span class="nf">SetObjColorAlphaByVertex</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_oRGBAs</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Set color and transparency (alpha) of object(s) by vertex</span>
<span class="sd">  (not defined for all object types).</span>

<span class="sd">  The number of objects is determined by the lenght of the object index list.</span>
<span class="sd">  Individual color (RGB) and alpha (A) values are expected as a tuples with 4</span>
<span class="sd">  elements (RGBA). For each object, a list of such RGBA tuples is expected,</span>
<span class="sd">  the number of tuples per object depends on the object type:</span>

<span class="sd">  * box, one RGBA tuple for each corner (n=4)</span>
<span class="sd">  * ellipse, RGBA[0]=center, RGBA[1]=circumfence, (n=2)</span>
<span class="sd">  * sector (actual sector), RGBA[0]=center, RGBA[1]=circumfence, (n=2)</span>
<span class="sd">  * sector (arc), RGBA[0]=outer, RGBA[1]=inner circumfence, (n=2)</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobjs          | list of objects,</span>
<span class="sd">                  | [o1, o2, ...],</span>
<span class="sd">                  | with oX being valid object indices</span>
<span class="sd">  _oRGBAs         | list of object colors/transparency as RGBA,</span>
<span class="sd">                  | [o1List, o2List, ...],</span>
<span class="sd">                  | with o1List := [(r1,g2,b1,a1),(r2, ...), ...]</span>
<span class="sd">                  | and 0 &lt;= r,g,b,a &lt;= 255</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">setObjColorAlphaByVertex</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_oRGBAs</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SetObjColorAlphaByVertex: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetShaderParams"><a class="viewcode-back" href="../commands.html#QDS.SetShaderParams">[docs]</a><span class="k">def</span> <span class="nf">SetShaderParams</span><span class="p">(</span><span class="n">_ishd</span><span class="p">,</span> <span class="n">_shParams</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Sets or changes the parameters of a shader.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _ishd           | index of existing shader</span>
<span class="sd">                  | see :py:func:`QDS.DefShader`</span>
<span class="sd">  _shParams       | list of shader parameters,</span>
<span class="sd">                  | depending on shader type</span>
<span class="sd">  =============== ==================================================</span>

<span class="sd">  Parameters by shader type:</span>

<span class="sd">  * &quot;SINE_WAVE_GRATING&quot;, drifting or stationary sine wave grating.</span>
<span class="sd">      [perLen_um, perDur_s, minRGBA, maxRGBA], with:</span>

<span class="sd">    - perLen_um, period length, in um</span>
<span class="sd">    - perDur_s, period duration, in seconds</span>
<span class="sd">    - minRGB, minimum color +tranparency (alpha)</span>
<span class="sd">    - maxRGB, maximum color +tranparency (alpha)</span>

<span class="sd">  * &quot;SINE_WAVE_GRATING_MIX&quot;, like SINE_WAVE_GRATING, but in addition, the </span>
<span class="sd">    shader mixes the object color including transparency (RGBA) with the </span>
<span class="sd">    grating colours, enabling transparent shader objects.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">setShaderParams</span><span class="p">(</span><span class="n">_ishd</span><span class="p">,</span> <span class="n">_shParams</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SetShaderParams: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetObjShader"><a class="viewcode-back" href="../commands.html#QDS.SetObjShader">[docs]</a><span class="k">def</span> <span class="nf">SetObjShader</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_ishds</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Attach shaders to the objects in the list.</span>

<span class="sd">  .. attention:: Other than object color, shader assignment cannot be</span>
<span class="sd">                 changed during the run section, that is after</span>
<span class="sd">                 :py:func:`QDS.StartScript` was called.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobjs          | list of objects,</span>
<span class="sd">                  | [o1, o2, ...],</span>
<span class="sd">                  | with oX being valid object indices</span>
<span class="sd">  _ishds          | list of existing shaders</span>
<span class="sd">                  | [s1, s2, ...],</span>
<span class="sd">                  | see :py:func:`QDS.DefShader`</span>
<span class="sd">                  | To detach a shader from an object</span>
<span class="sd">                  | set shader ID to -1</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if _Stim.isRunSect:</span>
<span class="sd">      _Stim.LastErrC = StimErrC.noShadersInRunSect</span>
<span class="sd">      raise(StimException(_Stim.LastErrC))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">setObjShader</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">,</span> <span class="n">_ishds</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SetObjShader: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="SetBkgColor"><a class="viewcode-back" href="../commands.html#QDS.SetBkgColor">[docs]</a><span class="k">def</span> <span class="nf">SetBkgColor</span><span class="p">(</span><span class="n">_col</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Set color of background.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _col            | color in RGB values as tupple (r,g,b)</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">setBkgColor</span><span class="p">(</span><span class="n">_col</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SetBkgColor: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Scene_Clear"><a class="viewcode-back" href="../commands.html#QDS.Scene_Clear">[docs]</a><span class="k">def</span> <span class="nf">Scene_Clear</span><span class="p">(</span><span class="n">_dur</span><span class="p">,</span> <span class="n">_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Clear screen and wait.</span>

<span class="sd">  Enabling marker causes the display of a white square in the bottom</span>
<span class="sd">  left corner of the screen and/or the output of a TTL pulse via the</span>
<span class="sd">  DIO24 board, if installed).</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _dur            | duration of scene in seconds</span>
<span class="sd">  _marker         | 0=no marker, 1=marker</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">clearScene</span><span class="p">(</span><span class="n">_dur</span><span class="p">,</span> <span class="p">(</span><span class="n">_marker</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;Scene_Clear: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Scene_RenderEx"><a class="viewcode-back" href="../commands.html#QDS.Scene_RenderEx">[docs]</a><span class="k">def</span> <span class="nf">Scene_RenderEx</span><span class="p">(</span><span class="n">_dur</span><span class="p">,</span> <span class="n">_iobjs</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_oang</span><span class="p">,</span> <span class="n">_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Draw objects and wait.</span>

<span class="sd">  Enabling marker causes the display of a white square in the bottom</span>
<span class="sd">  left corner of the screen and/or the output of a TTL pulse via the</span>
<span class="sd">  DIO24 board, if installed).</span>

<span class="sd">  .. attention:: **Extended version**: Number of objects not anymore a</span>
<span class="sd">                 parameter - it is determined by the lenght of the object</span>
<span class="sd">                 index list -, and allows to define magnification factors</span>
<span class="sd">                 and rotation angles for each object.</span>

<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _dur            | duration of scene in seconds</span>
<span class="sd">  _iobjs          | object indices, as [i1, i2, ...]</span>
<span class="sd">  _opos           | object positions, as [(x1,y1), (x2,y2), ...]</span>
<span class="sd">  *_omag*         | *object magification as [(mx,my), ...]*</span>
<span class="sd">  *_oang*         | *object rotation angles in degree as [a1, ...]*</span>
<span class="sd">  _marker         | 0=no marker, 1=marker</span>
<span class="sd">  =============== ==================================================</span>

<span class="sd">  *new or changed parameters*</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">renderScene</span><span class="p">(</span><span class="n">_dur</span><span class="p">,</span> <span class="n">_iobjs</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_oang</span><span class="p">,</span> <span class="p">(</span><span class="n">_marker</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;Scene_Render(Ex): </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="k">def</span> <span class="nf">Scene_Render</span><span class="p">(</span><span class="n">_dur</span><span class="p">,</span> <span class="n">_nobjs</span><span class="p">,</span> <span class="n">_iobjs</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_marker</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="n">_omag</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">)</span><span class="o">*</span><span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span>
  <span class="n">_oang</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_iobjs</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
  <span class="n">Scene_RenderEx</span><span class="p">(</span><span class="n">_dur</span><span class="p">,</span> <span class="n">_iobjs</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_oang</span><span class="p">,</span> <span class="n">_marker</span><span class="p">)</span>


<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Start_Movie"><a class="viewcode-back" href="../commands.html#QDS.Start_Movie">[docs]</a><span class="k">def</span> <span class="nf">Start_Movie</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_seq</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_trans</span><span class="p">,</span> <span class="n">_oang</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Start playing a movie object.</span>
<span class="sd"> </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | index of movie object</span>
<span class="sd">  _opos           | object positions, as (x1,y1)</span>
<span class="sd">  _seq            | sequence parameters, as </span>
<span class="sd">                  | [fr0, fr1, frreps, sqreps], with ... </span>
<span class="sd">                  | fr0=first, f1=last frame, </span>
<span class="sd">                  | frreps=number of frame repeats,</span>
<span class="sd">                  | sqreps=number of sequence repeats</span>
<span class="sd">  _omag           | object magification as (mx,my)</span>
<span class="sd">  _trans          | transparency, 0=transparent ... 255=opaque</span>
<span class="sd">  _oang           | object rotation angles in degree</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">startMovie</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_seq</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_trans</span><span class="p">,</span> <span class="n">_oang</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;Start_Movie: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="Start_Video"><a class="viewcode-back" href="../commands.html#QDS.Start_Video">[docs]</a><span class="k">def</span> <span class="nf">Start_Video</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_trans</span><span class="p">,</span> <span class="n">_oang</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Start playing a movie object.</span>
<span class="sd"> </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _iobj           | index of movie object</span>
<span class="sd">  _opos           | object positions, as (x1,y1)</span>
<span class="sd">  _omag           | object magification as (mx,my)</span>
<span class="sd">  _trans          | transparency, 0=transparent ... 255=opaque</span>
<span class="sd">  _oang           | object rotation angles in degree</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">startVideo</span><span class="p">(</span><span class="n">_iobj</span><span class="p">,</span> <span class="n">_opos</span><span class="p">,</span> <span class="n">_omag</span><span class="p">,</span> <span class="n">_trans</span><span class="p">,</span> <span class="n">_oang</span><span class="p">)</span>

  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;Start_Video: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>


<span class="c1"># =====================================================================</span>
<span class="c1"># Lightcrafter-related commands</span>

<span class="c1"># ---------------------------------------------------------------------</span>
<div class="viewcode-block" id="LC_softwareReset"><a class="viewcode-back" href="../commands.html#QDS.LC_softwareReset">[docs]</a><span class="k">def</span> <span class="nf">LC_softwareReset</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Signal the device to do a software reset. This will take a couple</span>
<span class="sd">  of seconds. After the reset the device is disconnected. </span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">processLCrCommand</span><span class="p">(</span><span class="n">stm</span><span class="o">.</span><span class="n">StimLCrCmd</span><span class="o">.</span><span class="n">softwareReset</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;LC_softwareReset: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------  </span>
<div class="viewcode-block" id="LC_setInputSource"><a class="viewcode-back" href="../commands.html#QDS.LC_setInputSource">[docs]</a><span class="k">def</span> <span class="nf">LC_setInputSource</span><span class="p">(</span><span class="n">_source</span><span class="p">,</span> <span class="n">_bitDepth</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Defines the input source of the device.</span>
<span class="sd">   </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _source         | 0=parallel interface (PP), </span>
<span class="sd">                  | 1=internal test pattern,</span>
<span class="sd">                  | 2=Flash</span>
<span class="sd">                  | 3=FPD-link</span>
<span class="sd">  _bitDepth       | Parallel interface bit depth</span>
<span class="sd">                  | 0=30, 1=24, 2=20, 3=16, 4=10, 5=8 bits</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">processLCrCommand</span><span class="p">(</span><span class="n">stm</span><span class="o">.</span><span class="n">StimLCrCmd</span><span class="o">.</span><span class="n">setInputSource</span><span class="p">,</span> 
                            <span class="p">[</span><span class="n">_source</span><span class="p">,</span> <span class="n">_bitDepth</span><span class="p">])</span>
  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;LC_setInputSource: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------  </span>
<div class="viewcode-block" id="LC_setDisplayMode"><a class="viewcode-back" href="../commands.html#QDS.LC_setDisplayMode">[docs]</a><span class="k">def</span> <span class="nf">LC_setDisplayMode</span><span class="p">(</span><span class="n">_mode</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Sets the display mode of the device.</span>
<span class="sd">   </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _mode           | 0=video display mode, </span>
<span class="sd">                  | Assumes streaming video image from the</span>
<span class="sd">                  | 30-bit RGB or FPD-link interface with a </span>
<span class="sd">                  | pixel resolution of up to 1280 × 800 up</span>
<span class="sd">                  | to 120 Hz. </span>
<span class="sd">                  | 1=Pattern display mode</span>
<span class="sd">                  | Assumes a 1-bit through 8-bit image with </span>
<span class="sd">                  | a pixel resolution of 912 × 1140 and </span>
<span class="sd">                  | bypasses all the image processing functions</span>
<span class="sd">                  | of the DLPC350.</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _Stim.processLCrCommand(stm.StimLCrCmd.setInputSource, </span>
<span class="sd">                            [_source, _bitDepth])</span>
<span class="sd">    &quot;&quot;&quot;</span>                              
    <span class="n">_Stim</span><span class="o">.</span><span class="n">processLCrCommand</span><span class="p">(</span><span class="n">stm</span><span class="o">.</span><span class="n">StimLCrCmd</span><span class="o">.</span><span class="n">setInputSource</span><span class="p">)</span> 
                             
  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;LC_setInputSource: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------  </span>
<div class="viewcode-block" id="LC_setLEDCurrents"><a class="viewcode-back" href="../commands.html#QDS.LC_setLEDCurrents">[docs]</a><span class="k">def</span> <span class="nf">LC_setLEDCurrents</span><span class="p">(</span><span class="n">_rgb</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Sets the current of the LEDs.</span>
<span class="sd">   </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _rgb            | currents as a list [r,g,b] </span>
<span class="sd">                  | with 0 &lt;= r,g,b &lt;= 255</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HERE&quot;</span><span class="p">,</span> <span class="n">_rgb</span><span class="p">)</span>  

  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">processLCrCommand</span><span class="p">(</span><span class="n">stm</span><span class="o">.</span><span class="n">StimLCrCmd</span><span class="o">.</span><span class="n">setLEDCurrents</span><span class="p">,</span> <span class="p">[</span><span class="n">_rgb</span><span class="p">])</span>
  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;LC_setLEDCurrents: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span></div>

<span class="c1"># ---------------------------------------------------------------------  </span>
<span class="k">def</span> <span class="nf">LC_setLEDEnabled</span><span class="p">(</span><span class="n">_rgb</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Enable or disable the LEDs.</span>
<span class="sd">   </span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  Parameters:</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  _rgb            | state of LEDas a list [r,g,b] </span>
<span class="sd">                  | with True or False</span>
<span class="sd">  =============== ==================================================</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_Stim</span><span class="o">.</span><span class="n">processLCrCommand</span><span class="p">(</span><span class="n">stm</span><span class="o">.</span><span class="n">StimLCrCmd</span><span class="o">.</span><span class="n">setLEDEnabled</span><span class="p">,</span> <span class="p">[</span><span class="n">_rgb</span><span class="p">])</span>
  <span class="k">except</span> <span class="n">stm</span><span class="o">.</span><span class="n">StimException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ssp</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;LC_setLEDEnabled: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">_Stim</span><span class="o">.</span><span class="n">LastErrC</span>


<span class="c1"># ---------------------------------------------------------------------</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/QDSpy_Logo_smaller.jpg" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">QDSpy 0.71 beta documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016 Thomas Euler, eulerlab @ CIN/University of Tübingen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>